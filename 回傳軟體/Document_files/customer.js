let croplist=["黃秋葵","花椰菜 青梗","胡瓜 黑刺","花胡瓜 其他","花胡瓜","冬瓜 白皮","絲瓜 其他","絲瓜","絲瓜 角瓜","絲瓜 長絲瓜","苦瓜 其他","苦瓜 白大米","苦瓜 青大米","苦瓜 山苦瓜","苦瓜 翠綠","扁蒲 花蒲","扁蒲 梨子蒲","茄子 其他","茄子 胭脂茄","茄子 麻荸茄","茄子 日本種","番茄 黑柿","番茄 牛番茄","甜椒 新香","甜椒 彩色種","甜椒 青椒","甜椒 水果彩椒","甜椒 進口","豌豆 紅花","豌豆 甜豌豆","豌豆 進口","菜豆 白色","菜豆 青色","菜豆 紅色","敏豆 白豆","敏豆 翼豆","敏豆 醜豆","毛豆 豆莢","毛豆 豆仁","青花苔","青花苔 進口","越瓜 青色","越瓜 白色","南瓜 其他","南瓜 木瓜形","南瓜 圓形","南瓜 黃如意","南瓜 青如意","南瓜 東昇","南瓜 栗子","隼人瓜","隼人瓜 瓜苗","石蓮花","辣椒 其他","辣椒 紅小","辣椒 青小","辣椒 朝天椒","辣椒 糯米椒","金針花","玉米 其他","玉米 玉米筍","玉米 糯米黑","玉米 甜軟殼","玉米 白龍王","玉米 進口","落花生 生","甘藍 初秋","甘藍 改良種","甘藍 紫色","甘藍 改良尖","甘藍 進口","小白菜 土白菜","小白菜 蚵仔白","小白菜 奶油白","小白菜 水耕","包心白 其他","包心白 包白","包心白 包頭蓮","包心白 進口","青江白菜 小梗","皇宮菜 小葉","皇宮菜 大葉","蕹菜 小葉","蕹菜 水蕹菜","芹菜 白梗","芹菜 西洋芹菜","芹菜 進口","菠菜 圓葉","菠菜 角葉","萵苣菜 其他","萵苣菜 廣東菜","萵苣菜 結球萵","萵苣菜 本島圓葉","萵苣菜 本島尖葉","萵苣菜 油麥菜","萵苣菜 蘿美","萵苣菜 紅捲綠捲","萵苣菜 水耕","萵苣菜 進口","芥菜 大芥菜","芥菜 小芥菜","芥藍菜 芥藍芽","芥藍菜","茼蒿","莧菜 紅莧菜","莧菜 白莧菜","油菜","甘藍 初秋","芫荽","九層塔","紅鳳菜 紅鳳菜","茴香","海菜 海帶","海菜 水蓮","巴西利","蕨菜 過貓","藤川七 川七葉","洋菇","洋菇 盒裝","草菇","濕木耳","濕香菇","金絲菇 金針菇","金絲菇 盒裝","蠔菇 鮑魚菇","秀珍菇","杏鮑菇","杏鮑菇 盒裝","鴻喜菇","鴻喜菇 盒裝","珊瑚菇","柳松菇","其他菇類","鹹菜 清心","鹹菜 帶葉","雪里紅","蘿蔔乾","醃瓜 漬 漬","熟筍 桂竹筍","熟筍 箭竹筍","筍茸","朴菜","其他","蘿蔔 矸仔","蘿蔔 櫻桃","蘿蔔 甜菜根","蘿蔔 進口","胡蘿蔔 未洗","胡蘿蔔 清洗","馬鈴薯 本產","馬鈴薯 進口","洋蔥 本產","洋蔥 進口","青蔥 日蔥","青蔥 大蔥","青蔥 紅蔥頭","青蔥 粉蔥","韭菜 白頭","韭菜 韭菜黃","韭菜 韭菜花","韭菜 青頭","大蒜 軟梗","大蒜 蒜頭","大蒜 蒜仁","大蒜 蒜瓣","竹筍 麻竹筍","竹筍 綠竹筍","竹筍 烏殼綠","竹筍 去殼","芋 檳榔心芋","荸薺","荸薺 加工","豆薯","牛蒡","蓮藕","蓮藕 蓮子","甘薯 其他","甘薯 臺農57號","甘薯 芋仔甘薯","甘薯 臺農66號","薑 老薑","薑 嫩薑","茭白筍 帶殼","茭白筍 去殼","薯蕷 白薯蕷","薯蕷 樹薯","薯蕷 進口","蘆筍 白蘆筍","蘆筍 綠蘆筍","蘆筍 蘆筍花","蘆筍 進口","芽菜類 其他","芽菜類 綠豆芽","芽菜類 黃豆芽","芽菜類 豌豆芽","芽菜類 苜蓿芽","香茅","冬瓜 其他","扁蒲 長形","敏豆 粉豆","萊豆 豆莢","萊豆 豆仁","青花苔 青花筍","辣椒 雞心","辣椒 青龍","虎豆 福豆","落花生 熟","甘藍 甘藍心","甘藍 甘藍芽","茼蒿 山茼蒿","油菜 小松菜","蕨菜 山蘇","西洋菜","黑甜仔菜","人參葉","濕木耳 盒裝","蕹菜 大葉","芹菜 青梗","蘋果","香蕉","芒果","鳳梨","西瓜","柚子","橙子","荔枝","柿子","桃子","李子","龍眼","枇杷","橄欖","榴槤","桑椹","石榴","蓮霧","無花果","柑橘","椰子","金桔","奇異果","木瓜","番石榴","杏子","莓果","青檸","紅毛丹","山竹","珍珠果"]

if(!weblsget(WEBLSNAME+"token")){
    href("index.html")
}

ajax("GET",AJAXURL+"getcustomerlist",function(event,data){
    if(data["success"]){
        let row=data["data"]

        for(let i=0;i<row.length;i=i+1){
            dompush("#main","div",`
                <div class="text big bold">姓名: ${row[i]["name"]}</div>
                <div class="text little">電話: ${row[i]["phone"]}</div>
                <div class="text little">類型: ${row[i]["type"]}</div>
                <div class="text little">地址: ${row[i]["address"]}</div>
                <div class="text little">土地面積: ${row[i]["area"]}${row[i]["areatype"]}</div>
                <div class="text little">作物: ${row[i]["crop"]}</div>
                <div class="flex">
                    <input type="button" class="button outline edit fill" data-id="${row[i]["id"]}" value="修改">
                    <input type="button" class="button error delete fill" data-id="${row[i]["id"]}" value="刪除">
                </div>
            `,{
                "class": "customerdiv xcenter"
            })
        }

        onclick(".edit",function(element,event){
            ajax("GET",AJAXURL+"getcustomer/"+dataset(element,"id"),function(event,data){
                if(data["success"]){
                    lightbox(null,"lightbox",function(event2){
                        return `
                            <div class="width-275px">
                                <div class="text big bold textcenter light">修改客戶</div>
                                <hr>
                                <div class="inputdiv">
                                    <div class="text little light textlabel">姓名</div>
                                    <div class="input underline light">
                                        <input type="text" id="name" value="${data["data"]["name"]}">
                                    </div>
                                </div>
                                <div class="inputdiv">
                                    <div class="text little light textlabel">電話</div>
                                    <div class="input underline light">
                                        <input type="text" id="phone" value="${data["data"]["phone"]}">
                                    </div>
                                </div>
                                <div class="inputdiv">
                                    <div class="text little light textlabel">類型</div>
                                    <div class="select light fill">
                                        <select class="fill" id="type">
                                            <option value="產履客戶">產履客戶</option>
                                            <option value="普通客戶">普通客戶</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="flex">
                                    <div class="inputdiv">
                                        <div class="text little light textlabel">土地面積</div>
                                        <div class="input underline light">
                                            <input type="text" id="area" value="${data["data"]["crop"]}">
                                        </div>
                                    </div>
                                    <div class="inputdiv">
                                        <div class="text little light textlabel">單位</div>
                                        <div class="select light fill">
                                            <select class="fill" id="areatype">
                                                <option value="甲">甲</option>
                                                <option value="分">分</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                                <div class="inputdiv">
                                    <div class="text little light textlabel">作物</div>
                                    <div class="input underline light">
                                        <input type="text" id="crop" value="${data["data"]["crop"]}">
                                    </div>
                                    <div id="tagdiv"></div>
                                </div>
                                <div class="inputdiv">
                                    <div class="text little light textlabel">地址</div>
                                    <div class="input underline light">
                                        <input type="text" id="address" value="${data["data"]["address"]}">
                                    </div>
                                </div>
                                <div class="textcenter inputdiv">
                                    <input type="button" class="button secondary inputbutton" id="lightboxback" value="返回">
                                    <input type="button" class="button outline inputbutton" id="submit" value="送出">
                                </div>
                            </div>
                        `
                    },"lightboxback",true,"none")

                    searchtagdiv("tagdiv","crop",croplist)

                    value("#type",data["data"]["type"])
                    value("#areatype",data["data"]["areatype"])

                    onenterkeydown("input[type=text]",function(){
                        click("#submit")
                    })

                    onclick("#submit",function(element2,event2){
                        ajax("POST",AJAXURL+"editcustomer/"+dataset(element,"id"),function(event,data){
                            if(data["success"]){
                                alert("修改成功")
                                href("")
                            }else{
                                alert(data["data"])
                            }
                        },chash({
                            "name": getvalue("name"),
                            "phone": getvalue("phone"),
                            "type": getvalue("type"),
                            "area": getvalue("area"),
                            "areatype": getvalue("areatype"),
                            "crop": getvalue("crop"),
                            "address": getvalue("address")
                        }),[
                            ["Authorization","Bearer "+weblsget(WEBLSNAME+"token")]
                        ])
                    })
                }else{
                    alert(data["data"])
                }
            },null,[
                ["Authorization","Bearer "+weblsget(WEBLSNAME+"token")]
            ])
        })

        onclick(".delete",function(element,event){
            lightbox(null,"lightbox",function(event2){
                return `
                    <div class="width-275px">
                        <div class="text big bold error textcenter">確定刪除?</div>
                        <hr>
                        <div class="text big bold error textcenter">確定要刪除此客戶嗎?</div>
                        <div class="text error textcenter">!!!此操作將無法復原!!!</div>
                        <div class="textcenter inputdiv">
                            <input type="button" class="button secondary inputbutton" id="lightboxback" value="返回">
                            <input type="button" class="button error inputbutton" id="submit" value="刪除">
                        </div>
                    </div>
                `
            },"lightboxback",true,"none")

            onenterkeydown("input[type=text]",function(){
                click("#submit")
            })

            onclick("#submit",function(element2,event2){
                ajax("DELETE",AJAXURL+"deletecustomer/"+dataset(element,"id"),function(event,data){
                    if(data["success"]){
                        alert("刪除成功")
                        href("")
                    }else{
                        alert(data["data"])
                    }
                },null,[
                    ["Authorization","Bearer "+weblsget(WEBLSNAME+"token")]
                ])
            })
        })
    }else{
        alert(data["data"])
    }
},null,[
    ["Authorization","Bearer "+weblsget(WEBLSNAME+"token")]
])

onclick("#newcustomer",function(element,event){
    lightbox(null,"lightbox",function(event2){
        return `
            <div class="width-275px">
                <div class="text big bold textcenter light">新增客戶</div>
                <hr>
                <div class="inputdiv">
                    <div class="text little light textlabel">姓名</div>
                    <div class="input underline light">
                        <input type="text" id="name">
                    </div>
                </div>
                <div class="inputdiv">
                    <div class="text little light textlabel">電話</div>
                    <div class="input underline light">
                        <input type="text" id="phone">
                    </div>
                </div>
                <div class="inputdiv">
                    <div class="text little light textlabel">類型</div>
                    <div class="select light fill">
                        <select class="fill" id="type">
                            <option value="產履客戶">產履客戶</option>
                            <option value="普通客戶">普通客戶</option>
                        </select>
                    </div>
                </div>
                <div class="flex">
                    <div class="inputdiv">
                        <div class="text little light textlabel">土地面積</div>
                        <div class="input underline light">
                            <input type="text" id="area">
                        </div>
                    </div>
                    <div class="inputdiv">
                        <div class="text little light textlabel">單位</div>
                        <div class="select light fill">
                            <select class="fill" id="areatype">
                                <option value="甲">甲</option>
                                <option value="分">分</option>
                            </select>
                        </div>
                    </div>
                </div>
                <div class="inputdiv">
                    <div class="text little light textlabel">作物</div>
                    <div class="input underline light">
                        <input type="text" id="crop">
                    </div>
                    <div id="tagdiv"></div>
                </div>
                <div class="inputdiv">
                    <div class="text little light textlabel">地址</div>
                    <div class="input underline light">
                        <input type="text" id="address">
                    </div>
                </div>
                <div class="textcenter inputdiv">
                    <input type="button" class="button secondary inputbutton" id="lightboxback" value="返回">
                    <input type="button" class="button outline inputbutton" id="submit" value="送出">
                </div>
            </div>
        `
    },"lightboxback",true,"none")

    searchtagdiv("tagdiv","crop",croplist)

    onenterkeydown("input[type=text]",function(){
        click("#submit")
    })

    onclick("#submit",function(element,event){
        ajax("POST",AJAXURL+"newcustomer",function(event,data){
            if(data["success"]){
                alert("新增成功")
                href("")
            }else{
                alert(data["data"])
            }
        },chash({
            "name": getvalue("name"),
            "phone": getvalue("phone"),
            "type": getvalue("type"),
            "area": getvalue("area"),
            "areatype": getvalue("areatype"),
            "crop": getvalue("crop"),
            "address": getvalue("address")
        }),[
            ["Authorization","Bearer "+weblsget(WEBLSNAME+"token")]
        ])
    })
})

onclick("#back",function(element,event){
    href("main.html")
})

onclick("#signout",function(element,event){
    ajax("POST",AJAXURL+"signout",function(event,data){
        if(data["success"]){
            alert("登出成功")
            weblsset(WEBLSNAME+"userid",null)
            weblsset(WEBLSNAME+"name",null)
            weblsset(WEBLSNAME+"token",null)
            href("index.html")
        }else{
            alert(data["data"])
        }
    },null,[
        ["Authorization","Bearer "+weblsget(WEBLSNAME+"token")]
    ])
})

document.onkeydown=function(event){
    if(event.key=="Enter"){
        docgetid("submit").click()
    }
}